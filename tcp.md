#TCP

**谈一谈网络编程学习经验**  
> http://blog.csdn.net/solstice/article/details/6527585   

**TCP的keep-alive选项** 
> http://www.cnblogs.com/wainiwann/p/4024583.html   --tcp的keep-alive
> http://blog.csdn.net/lys86_1205/article/details/21234867  --http keep_alive 和 tcp keep_alive  

```
tcp自己的keepalive有这样的一个bug：

正常情况下，连接的另一端主动调用colse关闭连接，tcp会通知，我们知道了该连接已经关闭。
但是如果tcp连接的另一端突然掉线，或者重启断电，这个时候我们并不知道网络已经关闭。
而此时，如果有发送数据失败，tcp会自动进行重传。重传包的优先级高于keepalive，
那就意味着，我们的keepalive总是不能发送出去。
而此时，我们也并不知道该连接已经出错而中断。在较长时间的重传失败之后，我们才会知道。

为了避免这种情况发生，我们要在tcp上层，自行控制(在应用层实现一个心跳包)。
对于此消息，记录发送时间和收到回应的时间。如果长时间没有回应，就可能是网络中断。
如果长时间没有发送，就是说，长时间没有进行通信，可以自行发一个包，用于keepalive，以保持该连接的存在。

-------http keep-alive与tcp keep-alive----------------
http keep-alive与tcp keep-alive，不是同一回事，意图不一样。
http keep-alive是为了让tcp活得更久一点，以便在同一个连接上传送多个http，提高socket的效率。
而tcp keep-alive是TCP的一种检测TCP连接状况的保鲜机制。
```

#网络结构  
```
第一层:物理层       网线,集线器   
第二层:数据链路层   网卡,交换机; 重要协议: ARP 地址解析鞋业, RARP 逆向地址解析协议;  
第三层:网络层       路由器 (三层交换机, 也实现交换机的功能); 重要协议: IP协议, ICMP协议(Internet Control Message Protocol); 
第四层:传输层       重要协议: TCP 字节流/UDP 数据报
第五层:会话层
第六层:表示层 
第七层:应用层

ICMP: 
它是TCP/IP协议族的一个子协议，用于在IP主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等
网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。  

ARP:
是根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，
以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节
约资源。


网关： 

网关是一个非常广泛的概念，我们很难给出一个确切的定义。
从第一层到第七层都可以有网关设备出现。
我们通常所说的网关主要是指第三层的设备,即路由器。

关于网关是工作在某几层的观点是不正确的，过于教条主义，而缺少对事物本质的了解。譬如说应用网关，一个应用网关的具体设备确实
会包括ISO模型中的所有7层（我们不关注具体的协议实现）但是实现网关功能的具体进程并不会涉及到下面的层次，那是一个网络设备要
得以运作必须的实现。而与网关的实现相关的处理只在特定的层次上操作。因此我们完全是可以确定网关的应用层次的。

有些网关具体的实现可能即包含了多个层次，但这只能说是这个具体的实现是同时包含了多种的网关的实现的，是复合型的而已。
即是说，路由器就是工作在的三层的网关设备。而代理服务器（特定与一定的服务，譬如web服务。）就是应用层的网关。
```
